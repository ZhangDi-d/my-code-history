###java 虚拟机与程序的生命周期

#### java虚拟机在如下几种情况下将结束生命周期

- 执行 System.exit()
- 程序正常执行结束
- 程序执行时遇到异常或错误而异常终止
- 操作系统错误导致java进程终止



#### 类的加载、连接、初始化、使用、卸载

**加载**：查找并加载类的二进制数据

**连接**：

- 验证：确保被加载的类的正确性
- 准备：为类的静态变量分配内存，并将其初始化为默认值
- 解析：把类中的符号引用转换为直接引用

**初始化**：为类的静态变量 赋予正确的初始值

伪代码：

```java
class Test{
	public static int a =1;
}
```

Test.class -> a = 0 -> a = 1

**使用**：类的实例化、方法调用

**卸载**：类从内存中卸载，卸载后无法再使用该类



#### java 程序对类的使用可以分为两种

- 主动使用
- 被动使用

所有的 Java 虚拟机实现必须在每个类或者接口被 java 程序**首次主动使用**时才初始化

**主动使用**

1. 创建类的实例
2. 访问某个类或接口的静态变量，或者对该静态变量进行赋值
3. 调用该类的静态方法
4. 反射
5. 初始化一个类的子类
6. java 虚拟机启动时被标记为启动类（main）的类
7. 1.7 后支持的动态语言

**被动使用**

除了以上其中，其他的使用 java 类的方式都是**被动使用**，都不会导致类的**初始化**



#### 类的加载

类的加载指的是将类的 .class 文件中的二进制数据读入到内存中，将其放入**运行时数据区**的**方法区**内，然后在内存中创建一个 java.lang.Class 对象（jvm 规范中没有指明 Class 对象位于哪里， HotSpot 虚拟机将其放在了方法区中）用来封装类在方法区中的数据结构

**加载 .class 文件的方式**

- 从本地磁盘中直接加载
- 通过网络下载 .class 文件
- 从 ZIP 、JAR 等归档文件中加载 .class 文件
- 从专有的数据库中提取 .class 文件
- 将 java 源文件动态编译为 .class 文件

```java
/*
   对一个静态字段来说，只有直接定义了该字段的类才会被初始化
   当一个类初始化时，要求其父类已经全部初始化完成了
*/
public class Test {
	pvsm() {
		sout(Child.str);
	}
}

class Parent {
		public static String str = "hello world";
		
		static {
			sout("Parent static block");
		}
}

class Child extend Parent {
		public static String str2 = "welcome";
		
		static {
			sout("Child static block");
		}
}
```

